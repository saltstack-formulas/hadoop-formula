{%- from 'hadoop/settings.sls' import hadoop with context %}
{%- from 'hadoop/hdfs/settings.sls' import hdfs with context %}
{%- from 'hadoop/mapred/settings.sls' import mapred with context %}
{%- set major = hadoop.major_version|string() -%}
<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<configuration>

<!--
    <property>
      <name>mapred.local.dir</name>
        <value>
{%- for d in mapred.local_disks -%}
{%- if loop.last -%}
{{ d }}/mapred
{%- else -%}
{{ d }}/mapred,
{%- endif -%}
{%- endfor -%}</value>
        <final>true</final>
    </property>
-->

{%- if major == '1' %}
    <property>
        <name>mapred.job.tracker</name>
        <value>{{ mapred.jobtracker_host }}:{{ mapred.jobtracker_port }}</value>
    </property>

    <property>
        <name>mapred.job.tracker.http.address</name>
        <value>{{ mapred.jobtracker_host }}:{{ mapred.jobtracker_http_port }}</value>
    </property>

    <property>
        <name>mapreduce.tasktracker.group</name>
        <value>hadoop</value>
    </property>

    <property>
        <name>mapreduce.history.server.http.address</name>
        <value>{{ mapred.jobtracker_host }}:{{ mapred.jobhistory_port }}</value>
    </property>
{%- else %}
    <property>
        <name>mapreduce.jobhistory.address</name>
        <value>{{ mapred.jobtracker_host }}:{{ mapred.jobhistory_port }}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.address</name>
        <value>{{ mapred.jobtracker_host }}:{{ mapred.jobhistory_webapp_port }}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.intermediate-done-dir</name>
        <value>{{ mapred.history_intermediate_done_dir }}</value>
    </property>

    <property>
        <name>mapreduce.jobhistory.done-dir</name>
        <value>{{ mapred.history_done_dir }}</value>
    </property>
{%- endif %}

{%- if mapred.config_mapred_site != '' %}
    <!-- added configuration -->
{{ mapred.config_mapred_site }}
{%- endif %}

</configuration>
